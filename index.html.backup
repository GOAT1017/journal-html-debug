<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Griffin's Rise: Advanced Trading Journal ‚Äî Pro Edition</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Tailwind for utility classes -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- FontAwesome for icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css">
  <!-- Unified Custom Styles -->
  <style>
    html, body {
      background: #232946;
      color: #dbeafe;
      font-family: 'Montserrat', system-ui, sans-serif;
      min-height: 100vh;
      font-size: 16px;
    }
    /* Tab Styles */
    .tab-active {
      background: linear-gradient(90deg, #2563eb 0%, #facc15 100%) !important;
      color: #fff !important;
      font-weight: 700;
      box-shadow: 0 2px 10px 0 rgba(80,0,120,0.08);
    }
    .tab-btn {
      transition: all 0.2s;
      font-weight: 600;
      letter-spacing: 0.04em;
    }
    /* Section Card Styles */
    .manual-section {
      background: #1a2236 !important;
      color: #dbeafe !important;
      border: 1px solid #28304a;
      box-shadow: 0 3px 18px 0 rgba(90,150,255,0.08);
      transition: box-shadow 0.2s;
    }
    .manual-section:hover {
      box-shadow: 0 8px 32px 0 rgba(120, 80, 255, 0.14);
      border-color: #2563eb;
    }
    /* Badges */
    .badge {
      display: inline-block;
      background: linear-gradient(90deg, #10b981 0%, #2563eb 100%);
      color: #fff;
      border-radius: 9999px;
      padding: 0.25em 0.9em;
      font-size: 1em;
      font-weight: 700;
      margin-left: 0.6em;
      vertical-align: middle;
      letter-spacing: 0.04em;
      box-shadow: 0 2px 4px 0 #2563eb22;
    }
    /* Readable form labels and text */
    label, input, select, textarea, .text-blue-900, .text-blue-100, .text-blue-700, .text-yellow-800 {
      color: #dbeafe !important;
    }
    /* Unified Input, Select, Textarea Styles (Light-on-Dark) */
    input, select, textarea {
      background: #192038 !important;
      color: #dbeafe !important;
      border: 1px solid #28304a !important;
      border-radius: 0.375rem;
      padding: 0.5rem 0.75rem;
      font-size: 1rem;
      font-family: 'Montserrat', system-ui, sans-serif;
      transition: border 0.2s, outline 0.2s;
      outline: none;
      box-shadow: none;
      width: 100%;
      min-width: 0;
      max-width: 100%;
      box-sizing: border-box;
    }
    input:focus, select:focus, textarea:focus {
      outline: 2px solid #facc15 !important;
      background: #232946 !important;
      color: #facc15 !important;
      border-color: #facc15 !important;
    }
    input[type="date"], input[type="number"] { color-scheme: dark; }
    select option { background: #232946; color: #dbeafe; }
    textarea { min-height: 2.5rem; resize: vertical;}
    ::placeholder { color: #b3c2e0 !important; opacity: 1 !important;}

    /* Journal Table Styles */
    table#journal-table th, table#journal-table td {
      border: 1px solid #28304a;
      padding: 8px;
      text-align: left;
    }
    table#journal-table th {
      background: #f8fafc;
      color: #232946;
      font-weight: 700;
    }
    table#journal-table tr:nth-child(even) {
      background: #28304a;
    }
    table#journal-table tr:nth-child(odd) {
      background: #1a2236;
    }
    table#journal-table {
      margin-top: 2rem;
      margin-bottom: 2rem;
      border-radius: 10px;
      overflow: hidden;
      width: 100%;
    }
    /* Journal Form Styles (Legacy support for old form) */
    #journal-form input, #journal-form select, #journal-form button {
      margin-right: 8px;
      margin-bottom: 8px;
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid #28304a;
      background: #192038;
      color: #dbeafe;
      font-size: 1em;
    }
    #journal-form button {
      background: linear-gradient(90deg, #facc15 0%, #2563eb 100%);
      color: #232946;
      font-weight: 700;
      cursor: pointer;
      border: none;
      transition: background 0.15s;
    }
    #journal-form button:hover {
      background: linear-gradient(90deg, #2563eb 0%, #facc15 100%);
      color: #fff;
    }
    /* Journal Table/Row Animation & UX */
    .highlight-row { background: #facc1530 !important; transition: background 0.7s;}
    .animate-pulse { animation: pulse 0.9s cubic-bezier(0.4, 0, 0.6, 1) 1;}
    @keyframes pulse { 0%,100%{box-shadow:0 0 0 0 #facc1544;} 70%{box-shadow:0 0 14px 6px #facc1560;}}
    .animate-bounce { animation: badgeBounce 0.55s cubic-bezier(.18,1.3,.57,.99) 1;}
    @keyframes badgeBounce { 0%{transform:scale(1);} 25%{transform:scale(1.13);} 40%{transform:scale(0.96);} 70%{transform:scale(1.07);} 100%{transform:scale(1);}
    }
    .journal-badge.locked { opacity: 0.35; filter: grayscale(0.82); border: 2px dashed #64748b; color: #64748b; pointer-events: none;}
  </style>
</head>
<body>
  <header class="bg-[#232946] shadow-lg py-4 mb-8 border-b border-blue-900">
    <div class="container mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-2">
      <div class="flex items-center space-x-5">
        <img src="/public/griffin-rise-log.png" alt="Griffin's Rise Trading Journal Logo"
          class="h-20 w-20 rounded-full shadow-xl ring-4 ring-blue-500 ring-opacity-60 bg-white object-contain" style="min-width:120px;" />
        <div>
          <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight text-blue-100" style="font-family:Montserrat,sans-serif">
            Griffin's Rise: <span class="text-yellow-400">Advanced Trading Journal</span>
          </h1>
          <span class="badge mt-2 ml-1 align-middle text-base" style="background:linear-gradient(90deg,#f59e42 0%,#2563eb 100%);color:#fff;">PRO EDITION</span>
        </div>
      </div>
      <nav class="flex flex-wrap gap-1 md:gap-2 items-center mt-4 md:mt-0">
        <button id="educationTab" class="tab-btn bg-gray-700 hover:bg-blue-800 px-4 py-2 rounded transition hidden">Education</button>
        <button id="syllabusTab" class="tab-btn bg-blue-900 hover:bg-blue-700 px-4 py-2 rounded transition hidden">Syllabus</button>
        <button id="trainingManualTab" class="tab-btn bg-yellow-700 hover:bg-yellow-600 px-4 py-2 rounded transition hidden">Training Manual</button>
        <button id="journalTab" class="tab-btn bg-gray-700 hover:bg-blue-900 px-4 py-2 rounded transition hidden">Journal</button>
        <button id="dashboardTab" class="tab-btn bg-gray-700 hover:bg-blue-900 px-4 py-2 rounded transition hidden">Dashboard</button>
        <button id="loginTab" class="tab-btn bg-green-700 hover:bg-green-600 px-4 py-2 rounded transition">Register / Login</button>
        <button id="logoutBtn" class="tab-btn bg-red-700 hover:bg-red-800 px-4 py-2 rounded transition hidden">Logout</button>
      </nav>
    </div>
  </header>
  <main class="container mx-auto px-4 max-w-4xl">
    <!-- Login/Register -->
    <section id="loginContent">
      <div class="manual-section p-6 rounded-lg shadow-lg max-w-md mx-auto mt-8">
        <h2 class="text-2xl font-bold mb-4 text-green-400 text-center">Register / Login</h2>
        <form id="loginForm" class="space-y-4">
          <div>
            <label class="block mb-1" for="login-username">Username</label>
            <input id="login-username" type="text" class="w-full px-3 py-2 rounded" required />
          </div>
          <div>
            <label class="block mb-1" for="login-password">Password</label>
            <input id="login-password" type="password" class="w-full px-3 py-2 rounded" required />
          </div>
          <div class="flex justify-between items-center">
            <button type="submit" class="bg-green-700 hover:bg-green-800 text-white px-4 py-2 rounded font-semibold transition">Login</button>
            <button type="button" id="switchToRegister" class="text-green-300 text-sm hover:underline">Register</button>
          </div>
        </form>
        <form id="registerForm" class="space-y-4 hidden">
          <div>
            <label class="block mb-1" for="register-username">Username</label>
            <input id="register-username" type="text" class="w-full px-3 py-2 rounded" required />
          </div>
          <div>
            <label class="block mb-1" for="register-password">Password</label>
            <input id="register-password" type="password" class="w-full px-3 py-2 rounded" required />
          </div>
          <div>
            <label class="block mb-1" for="register-confirm">Confirm Password</label>
            <input id="register-confirm" type="password" class="w-full px-3 py-2 rounded" required />
          </div>
          <div class="flex justify-between items-center">
            <button type="submit" class="bg-green-700 hover:bg-green-800 text-white px-4 py-2 rounded font-semibold transition">Register</button>
            <button type="button" id="switchToLogin" class="text-green-300 text-sm hover:underline">Login</button>
          </div>
        </form>
        <div id="loginMessage" class="mt-4 text-center text-sm text-green-400"></div>
      </div>
    </section>

   <!-- Education Tab -->
<section id="educationContent" class="hidden">
  <div class="manual-section p-8 rounded-xl shadow mb-8">
    <div class="flex flex-col md:flex-row items-center gap-8">
      <div class="md:w-2/3">
        <h2 class="text-3xl font-extrabold mb-3 text-blue-100">Education</h2>
        <ul class="mt-4 list-disc ml-8 text-blue-50 text-base space-y-1">
          <li>
            Explore the full curriculum in the
            <span class="text-yellow-300 font-semibold">Syllabus</span> tab.
          </li>
          <li>
            Track your lesson progress and earn achievement badges for mastery.
          </li>
          <li>
            Access detailed, actionable how-to guides in the Training Manual.
          </li>
        </ul>
        <div class="mt-6 bg-blue-900/90 border-l-4 border-blue-400 px-4 py-3 rounded">
          <b class="text-yellow-200">Tip:</b>
          <span class="text-blue-100">
            Use the <span class="text-yellow-300">Training Manual</span> for step-by-step checklists. All progress is saved automatically.
          </span>
        </div>
      </div>
      <div class="md:w-1/3 flex justify-center">
        <img src="/public/griffin-rise-log.png"
             alt="Griffin's Rise Trading Journal Logo"
             class="w-[320px] max-w-full h-auto rounded-xl shadow ring-8 ring-yellow-200 ring-opacity-80 bg-white object-contain" />
      </div>
    </div>
  </div>
</section>
<!-- Syllabus Section: Griffin's Rise Trading Mastery (2025.1, Upgraded) -->
<section id="syllabusContent" class="hidden">
  <div class="manual-section syllabus-section p-8 rounded-xl shadow mb-8 mx-auto bg-[#232946] border border-blue-900" style="max-width:60rem;">
    <!-- Header -->
    <div class="flex items-center gap-4 mb-6">
      <i class="fas fa-graduation-cap text-yellow-300 text-3xl"></i>
      <h2 class="text-3xl font-extrabold text-blue-200 flex-1">Syllabus: Griffin's Rise Trading Mastery</h2>
      <span class="inline-block rounded px-3 py-1 bg-blue-800/70 text-blue-100 font-semibold text-base border border-blue-700 shadow">Version 2025.1</span>
    </div>
    <!-- Progress Tracker -->
    <div class="mb-8">
      <h3 class="text-xl font-bold text-yellow-100 mb-2 flex items-center gap-2"><i class="fas fa-tasks"></i> Your Progress</h3>
      <div class="w-full bg-blue-900/60 rounded-full h-6 shadow relative">
        <div id="syllabus-progress-bar" class="bg-gradient-to-r from-yellow-400 to-green-300 h-6 rounded-full transition-all" style="width:0%"></div>
        <span id="syllabus-progress-label" class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 text-blue-900 font-bold"></span>
      </div>
      <div class="flex justify-between items-center mt-2">
        <div class="flex flex-wrap gap-2 text-sm text-blue-100" id="syllabus-completed-labels"></div>
        <button id="syllabus-reset-btn" class="px-3 py-1 rounded bg-red-700/80 text-red-100 font-semibold text-sm shadow hover:bg-red-900 transition" title="Reset Progress">
          <i class="fas fa-undo-alt"></i> Reset Progress
        </button>
      </div>
    </div>
    <!-- Table of Contents -->
    <div class="mb-8">
      <h3 class="text-xl font-bold text-yellow-100 mb-3 flex items-center gap-2"><i class="fas fa-list-ol"></i> Table of Contents</h3>
      <ol class="pl-8 list-decimal text-blue-100 space-y-1">
        <li><a href="#syllabus-foundation" class="syllabus-link">The Foundation: Mindset, Platform, Risk</a></li>
        <li><a href="#syllabus-discovery" class="syllabus-link">Short Thesis & Discovery</a></li>
        <li><a href="#syllabus-execution" class="syllabus-link">Execution & Journaling</a></li>
        <li><a href="#syllabus-psychology" class="syllabus-link">Advanced Scenarios & Psychology</a></li>
        <li><a href="#syllabus-mastery" class="syllabus-link">Mastery & Peer Review</a></li>
      </ol>
    </div>

    <!-- Syllabus Main Content -->
    <div class="space-y-12">
      <!-- FOUNDATION -->
      <div id="syllabus-foundation" class="syllabus-phase">
        <div class="flex items-center gap-3 mb-2">
          <i class="fas fa-cubes text-green-300 text-xl"></i>
          <h3 class="text-2xl font-bold text-yellow-200">1. The Foundation: Mindset, Platform, Risk</h3>
          <button class="syllabus-complete-btn ml-auto px-3 py-1 rounded bg-green-700/80 text-green-100 font-semibold text-sm shadow hidden"><i class="fas fa-check-circle"></i> Mark Phase Complete</button>
        </div>
        <div id="syllabus-phase-0-stats" class="syllabus-phase-stats mb-2"></div>
        <ol class="list-decimal pl-8 text-blue-100"> ... </ol>
      </div>
      <!-- DISCOVERY -->
      <div id="syllabus-discovery" class="syllabus-phase">
        <div class="flex items-center gap-3 mb-2">
          <i class="fas fa-search-dollar text-teal-300 text-xl"></i>
          <h3 class="text-2xl font-bold text-yellow-200">2. Short Thesis & Discovery</h3>
          <button class="syllabus-complete-btn ml-auto px-3 py-1 rounded bg-green-700/80 text-green-100 font-semibold text-sm shadow hidden"><i class="fas fa-check-circle"></i> Mark Phase Complete</button>
        </div>
        <div id="syllabus-phase-1-stats" class="syllabus-phase-stats mb-2"></div>
        <ol class="list-decimal pl-8 text-blue-100"> ... </ol>
      </div>
      <!-- EXECUTION & JOURNALING -->
      <div id="syllabus-execution" class="syllabus-phase">
        <div class="flex items-center gap-3 mb-2">
          <i class="fas fa-pen-fancy text-pink-300 text-xl"></i>
          <h3 class="text-2xl font-bold text-yellow-200">3. Execution & Journaling</h3>
          <button class="syllabus-complete-btn ml-auto px-3 py-1 rounded bg-green-700/80 text-green-100 font-semibold text-sm shadow hidden"><i class="fas fa-check-circle"></i> Mark Phase Complete</button>
        </div>
        <div id="syllabus-phase-2-stats" class="syllabus-phase-stats mb-2"></div>
        <ol class="list-decimal pl-8 text-blue-100"> ... </ol>
      </div>
      <!-- PSYCHOLOGY -->
      <div id="syllabus-psychology" class="syllabus-phase">
        <div class="flex items-center gap-3 mb-2">
          <i class="fas fa-brain text-purple-300 text-xl"></i>
          <h3 class="text-2xl font-bold text-yellow-200">4. Advanced Scenarios & Psychology</h3>
          <button class="syllabus-complete-btn ml-auto px-3 py-1 rounded bg-green-700/80 text-green-100 font-semibold text-sm shadow hidden"><i class="fas fa-check-circle"></i> Mark Phase Complete</button>
        </div>
        <div id="syllabus-phase-3-stats" class="syllabus-phase-stats mb-2"></div>
        <ol class="list-decimal pl-8 text-blue-100"> ... </ol>
      </div>
      <!-- MASTERY -->
      <div id="syllabus-mastery" class="syllabus-phase">
        <div class="flex items-center gap-3 mb-2">
          <i class="fas fa-certificate text-yellow-400 text-xl"></i>
          <h3 class="text-2xl font-bold text-yellow-200">5. Mastery & Peer Review</h3>
          <button class="syllabus-complete-btn ml-auto px-3 py-1 rounded bg-green-700/80 text-green-100 font-semibold text-sm shadow hidden"><i class="fas fa-check-circle"></i> Mark Phase Complete</button>
        </div>
        <div id="syllabus-phase-4-stats" class="syllabus-phase-stats mb-2"></div>
        <ol class="list-decimal pl-8 text-blue-100"> ... </ol>
      </div>
    </div>
    <!-- Syllabus Footer / Call to action -->
    <div class="bg-blue-900 rounded-lg p-3 shadow-lg inline-block mt-10">
      <span class="text-white text-lg font-bold">
        Tip: Review each phase before moving to the next. Mark as complete to track your journey!
      </span>
    </div>
    <div class="mt-4 text-blue-200 text-sm">
      <i class="fas fa-lightbulb text-yellow-300"></i> Need more resources? Visit the
      <a href="https://www.babypips.com/" target="_blank" rel="noopener" class="underline text-yellow-200 hover:text-green-200">BabyPips School</a>
      and
      <a href="https://www.tradingview.com/" target="_blank" rel="noopener" class="underline text-yellow-200 hover:text-green-200">TradingView Ideas</a>.
    </div>
  </div>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css">
  <style>
    .manual-section {font-family: 'Montserrat', system-ui, sans-serif;}
    .syllabus-section details[open] summary:before {content:"‚ñº "; color:#facc15;}
    .syllabus-section summary:before { content:"‚ñ∫ "; color:#facc15;}
    .syllabus-section details {margin-top:0.45rem;}
    .syllabus-section .syllabus-link {color:#facc15;text-decoration:underline;transition:color 0.2s;}
    .syllabus-section .syllabus-link:hover {color:#34d399;}
    .syllabus-section .syllabus-complete-btn {transition:background 0.2s;}
    .syllabus-section .syllabus-complete-btn.completed {background: linear-gradient(90deg,#34d399,#facc15);}
    .syllabus-section .syllabus-phase.completed {background:rgba(34,197,94,0.07);}
    .syllabus-section .syllabus-phase.completed h3, .syllabus-section .syllabus-phase.completed i {color:#34d399!important;}
    .syllabus-phase-stats {margin: 0.6rem 0 0.9rem 0; padding: 0.8rem 1rem; background: #28304a88; border-radius: 0.6rem; box-shadow: 0 2px 10px 0 #0002;}
    .syllabus-phase-stats .phase-progbar {height: 0.7rem; background: #22253e; border-radius: 99px; overflow: hidden; margin-bottom: 0.2rem;}
    .syllabus-phase-stats .phase-progbar-fill {height: 0.7rem; border-radius: 99px; background: linear-gradient(90deg, #fde047 55%, #34d399 100%);}
    .syllabus-phase-stats .stat-label {color:#facc15;font-weight:bold;margin-right:0.65em;}
    .syllabus-phase-stats .stat-value {color:#f9fafb;font-weight:bold;}
    .syllabus-phase-stats .stat-pnl-pos {color:#34d399;}
    .syllabus-phase-stats .stat-pnl-neg {color:#f87171;}
    .syllabus-phase-stats .phase-unlocked {color: #34d399; font-weight: bold;}
    .syllabus-phase-stats .phase-locked {color: #64748b; font-weight: bold;}
    @media (max-width: 650px) {
      .manual-section {padding:1.2rem!important;}
      .syllabus-section h2 {font-size:1.3rem;}
      .syllabus-section h3 {font-size:1.1rem;}
      .syllabus-section ul, .syllabus-section ol {font-size:1rem;}
      .syllabus-phase-stats {padding:0.6rem 0.5rem;}
    }
  </style>
  <script>
    // === PHASE DEFINITIONS ===
    // You can adjust the trade requirements/progression here
    const SYLLABUS_PHASES = [
      {
        id: "syllabus-foundation",
        name: "The Foundation: Mindset, Platform, Risk",
        tradeReq: 3, // minimum trades to complete phase 1
      },
      {
        id: "syllabus-discovery",
        name: "Short Thesis & Discovery",
        tradeReq: 4, // minimum trades to complete phase 2
      },
      {
        id: "syllabus-execution",
        name: "Execution & Journaling",
        tradeReq: 5, // minimum trades to complete phase 3
      },
      {
        id: "syllabus-psychology",
        name: "Advanced Scenarios & Psychology",
        tradeReq: 6, // minimum trades to complete phase 4
      },
      {
        id: "syllabus-mastery",
        name: "Mastery & Peer Review",
        tradeReq: 8, // minimum trades to complete phase 5
      }
    ];

    // === Syllabus Phase Progress Logic (Upgraded) ===
    document.addEventListener("DOMContentLoaded", function(){
      const phaseIds = SYLLABUS_PHASES.map(p=>p.id);
      const btns = Array.from(document.querySelectorAll(".syllabus-complete-btn"));
      const phases = phaseIds.map(id=>document.getElementById(id));
      btns.forEach(btn=>btn.classList.remove("hidden"));

      // --- Load State ---
      let completed = JSON.parse(localStorage.getItem("syllabusCompletedPhases")||"[]");

      // --- Get Journal Helper ---
      function getJournal() {
        try {
          const data = localStorage.getItem(window.JOURNAL_KEY || "griffinsrise_journal_v1");
          return data ? JSON.parse(data) : [];
        } catch { return []; }
      }

      // --- Assign Journal Entries to Phases (auto or by .phase field) ---
      function assignEntriesToPhases(journal) {
        // If entries have a .phase property, use it; otherwise auto-assign by trade order
        const entriesByPhase = SYLLABUS_PHASES.map(()=>[]);
        let tradeIdx = 0;
        for(const entry of journal) {
          let phaseIdx = typeof entry.phase === "number" ? entry.phase
            : (typeof entry.phase === "string" && phaseIds.includes(entry.phase)) ? phaseIds.indexOf(entry.phase)
            : null;
          if(phaseIdx==null) {
            // Assign by order: fill each phase as tradeReq is met
            let running = 0, found = false;
            for(let i=0; i<SYLLABUS_PHASES.length; ++i) {
              running += SYLLABUS_PHASES[i].tradeReq;
              if(tradeIdx < running) { phaseIdx = i; found=true; break; }
            }
            if(!found) phaseIdx = SYLLABUS_PHASES.length-1; // overflow to last phase
          }
          if(entriesByPhase[phaseIdx]) entriesByPhase[phaseIdx].push(entry);
          tradeIdx++;
        }
        return entriesByPhase;
      }

      // --- Update Phase Stats & Unlock ---
      function updatePhaseStatsAndUnlock() {
        const journal = getJournal();
        const entriesByPhase = assignEntriesToPhases(journal);
        let unlocked = [];
        let totalPhases = SYLLABUS_PHASES.length;

        // Per-phase stats and unlock
        SYLLABUS_PHASES.forEach((phase, i) => {
          const entries = entriesByPhase[i] || [];
          const wins = entries.filter(e=>e.outcome==="Win").length;
          const losses = entries.filter(e=>e.outcome==="Loss").length;
          const breakevens = entries.filter(e=>e.outcome==="Breakeven").length;
          const pnl = entries.reduce((sum,e)=>sum+(parseFloat(e.pnl)||0), 0);
          const prog = Math.min(1, entries.length/phase.tradeReq);
          const phaseStatsDiv = document.getElementById(`syllabus-phase-${i}-stats`);
          phaseStatsDiv.innerHTML =
            `<div class="phase-progbar mb-2"><div class="phase-progbar-fill" style="width:${Math.round(prog*100)}%"></div></div>
            <div>
              <span class="stat-label">Status:</span>
              <span class="${entries.length>=phase.tradeReq ? 'phase-unlocked' : 'phase-locked'}">
                ${entries.length>=phase.tradeReq ? 'Unlocked' : 'Locked'}
              </span>
              <span style="margin-left:1.2em;" class="stat-label">Progress:</span>
              <span class="stat-value">${entries.length}/${phase.tradeReq} trades</span>
            </div>
            <div>
              <span class="stat-label">Wins:</span> <span class="stat-value">${wins}</span>
              <span class="stat-label">Losses:</span> <span class="stat-value">${losses}</span>
              <span class="stat-label">Breakeven:</span> <span class="stat-value">${breakevens}</span>
              <span class="stat-label">Net P&L:</span> <span class="stat-value ${pnl>=0?'stat-pnl-pos':'stat-pnl-neg'}">${pnl>=0?'+':''}${pnl.toFixed(2)}</span>
            </div>
            ${entries.length<phase.tradeReq && (phase.tradeReq-entries.length)<=2 && entries.length>0
                ? `<div class="mt-1 text-yellow-200 text-[0.92em] font-semibold"><i class="fas fa-bolt mr-1"></i>Almost unlocked! Log ${phase.tradeReq-entries.length} more trade${phase.tradeReq-entries.length>1?'s':''}.</div>`
                : ''}
            ${entries.length>=phase.tradeReq && !completed.includes(i)
                ? `<div class="mt-1 text-green-300 text-[0.92em] font-semibold"><i class="fas fa-unlock mr-1"></i>Phase unlocked! Mark complete to advance.</div>`
                : ''}
            `;

          if(entries.length>=phase.tradeReq) unlocked.push(i);
        });

        // Auto-complete newly unlocked phases unless already marked
        unlocked.forEach(i=>{
          if(!completed.includes(i)){
            completed.push(i);
            // Animate phase card
            const ph = phases[i];
            if(ph) {
              ph.classList.add("ring-4","ring-green-400");
              setTimeout(()=>ph.classList.remove("ring-4","ring-green-400"), 1300);
            }
            // (Optional) Confetti: if you have confetti lib, enable here
            if(window.confetti) setTimeout(()=>confetti({particleCount:60,spread:70,origin:{y:0.25}}),500);
          }
        });

        // Save state
        localStorage.setItem("syllabusCompletedPhases",JSON.stringify(completed));
        // Progress bar
        const prog = Math.floor((completed.length/totalPhases)*100);
        document.getElementById("syllabus-progress-bar").style.width = prog+"%";
        document.getElementById("syllabus-progress-label").textContent = prog+"% Complete";
        // Completed labels
        const labels = document.getElementById("syllabus-completed-labels");
        labels.innerHTML = completed.map(idx=>{
          const h3=phases[idx]?.querySelector("h3");
          return `<span class="bg-green-700/60 px-2 py-1 rounded text-green-100 font-semibold shadow">${h3? h3.textContent : "Phase "+(idx+1)}</span>`;
        }).join(" ");
        // Visual phase marking
        phases.forEach((ph,idx)=>{
          if(completed.includes(idx)){
            ph.classList.add("completed");
            btns[idx] && btns[idx].classList.add("completed");
            btns[idx] && (btns[idx].innerHTML='<i class="fas fa-check-double"></i> Completed');
          } else {
            ph.classList.remove("completed");
            btns[idx] && btns[idx].classList.remove("completed");
            btns[idx] && (btns[idx].innerHTML='<i class="fas fa-check-circle"></i> Mark Phase Complete');
          }
        });
      }

      // Manual Mark Complete (override)
      btns.forEach((btn,idx)=>{
        btn.onclick = function(){
          if(!completed.includes(idx)){
            completed.push(idx);
            localStorage.setItem("syllabusCompletedPhases",JSON.stringify(completed));
            updatePhaseStatsAndUnlock();
          }
        };
      });

      // Reset Progress Button
      const resetBtn = document.getElementById("syllabus-reset-btn");
      if (resetBtn) {
        resetBtn.onclick = function(){
          if(confirm("Are you sure you want to reset your syllabus progress? This cannot be undone.")){
            completed = [];
            localStorage.removeItem("syllabusCompletedPhases");
            updatePhaseStatsAndUnlock();
          }
        };
      }

      // Table of contents scroll
      document.querySelectorAll(".syllabus-link").forEach(link=>{
        link.onclick = function(e){
          e.preventDefault();
          const id = link.getAttribute("href").replace("#","");
          const el = document.getElementById(id);
          if(el){
            el.scrollIntoView({behavior:"smooth",block:"start"});
            el.classList.add("ring-4","ring-yellow-300");
            setTimeout(()=>el.classList.remove("ring-4","ring-yellow-300"),1500);
          }
        }
      });

      // === INITIALIZE & LIVE UPDATES ===
      updatePhaseStatsAndUnlock();
      // Listen for journal changes (if journal triggers this event)
      window.addEventListener("journalChanged", updatePhaseStatsAndUnlock);
      // Or poll every 5 seconds (as fallback)
      setInterval(updatePhaseStatsAndUnlock, 5000);
    });
  </script>
</section>  
<!-- Training Manual -->
<!-- Training Manual Section (with full curriculum, lessons, and how-to, formatted for display) -->
<section id="trainingManualContent" class="hidden">
  <div class="manual-section p-8 rounded-xl shadow mb-8 mx-auto bg-[#232946] border border-blue-900" style="max-width:60rem;">
    <h2 class="text-3xl font-extrabold mb-5 text-blue-200 flex items-center gap-3">
      <i class="fas fa-book text-yellow-300"></i>
      Training Manual: Short Thesis Mastery & Journaling
    </h2>
    <div class="text-blue-100 text-base sm:text-lg space-y-10">
      <!-- PHASES/LESSONS -->
      <!-- ========== THE FOUNDATION ========== -->
      <div>
        <h3 class="text-2xl font-bold text-yellow-200 mb-3">Phase 1: THE FOUNDATION</h3>
        <!-- Lesson 1 -->
        <div class="mb-4">
          <h4 class="text-xl font-bold text-pink-200 mb-1">Lesson 1: Foundation, Mindset, & Platform Choices</h4>
          <ul class="pl-7 list-disc mb-2">
            <li>This lesson builds your mental armor and understanding of the battlefield.</li>
            <li><span class="font-semibold">Task 1: Internalize Deep Skepticism</span>
              <ul class="list-decimal pl-6 mb-1">
                <li>Open www.x.com (formerly Twitter) and search for #memecoin or #1000xgem.</li>
                <li>Click the 'Latest' tab to see new posts; find a post with high engagement promoting a coin (e.g., $WXYZ).</li>
                <li>Search for the coin's official website. In your journal, write three skeptical questions based on your findings.</li>
              </ul>
              <div class="text-blue-300 text-sm pl-7 italic">e.g. "The website claims 'AI-powered decentralization.' Where is the technical whitepaper that explains this? Which AI models? How is it different from existing projects?"</div>
            </li>
            <li><span class="font-semibold">Task 2: Internalize Probabilistic Thinking</span>
              <ul class="list-decimal pl-6 mb-1">
                <li>Read the "Probabilistic Thinking" resource from the syllabus.</li>
                <li>In your journal, complete: "Being a probabilistic trader means I accept that I can do everything right and still lose a trade... My goal is to be profitable over a large series of trades because my winners will outweigh my losers."</li>
              </ul>
            </li>
            <li><span class="font-semibold">Task 3: Learn to Formulate a Short Thesis</span>
              <ul class="list-decimal pl-6 mb-1">
                <li>Go to www.coingecko.com. Find and add the '% ATH' column if needed.</li>
                <li>Click '% ATH' twice to sort by largest drops. Find a coin with a recognizable name and 24h volume &gt; $500,000.</li>
                <li>In your journal, write a one-sentence short thesis for a coin you find.
                  <div class="text-blue-300 text-sm pl-7 italic">e.g. "The short thesis for ExampleCoin (EXC) is that it was a failed hype cycle, confirmed by a 95% price collapse on declining volume."</div>
                </li>
              </ul>
            </li>
          </ul>
        </div>
        <!-- Lesson 2 -->
        <div class="mb-4">
          <h4 class="text-xl font-bold text-pink-200 mb-1">Lesson 2: Risk Management Mastery</h4>
          <div>This is the science of survival. üë®‚Äçüî¨</div>
          <div class="mt-1 mb-2 font-semibold">Task: Master Position Sizing</div>
          <ul class="list-decimal pl-6">
            <li>Open the BabyPips Position Size Calculator from the syllabus resources.</li>
            <li>Scenario: $10,000 account, risk 1% on SOL short, enter at $150, stop-loss at $153.</li>
            <li>In calculator: Account Currency USD, Balance 10000, Risk% 1, Stop Loss (pips) 3000 (since $3 = 3000 pips), Entry Price 150.</li>
            <li>Calculator gives position size‚Äîamount of SOL to short to risk only $100.</li>
            <li>Do the three sample trades from the syllabus in your journal.</li>
          </ul>
        </div>
        <!-- Lesson 3 -->
        <div class="mb-4">
          <h4 class="text-xl font-bold text-pink-200 mb-1">Lesson 3: Platform Mastery & Tool Setup</h4>
          <div>This is your pre-flight checklist. üöÄ</div>
          <div class="font-semibold mt-1">Task 1: Secure Your CeFi Account (MEXC)</div>
          <ul class="list-decimal pl-6 mb-1">
            <li>Log into MEXC. Go to 'Security' under your profile.</li>
            <li>Setup MEXC/Google Authenticator and back up your security key.</li>
          </ul>
          <div class="font-semibold">Task 2: Secure Your DeFi Wallet (Ledger + MetaMask)</div>
          <ul class="list-decimal pl-6 mb-1">
            <li>Plug in Ledger, unlock, and open Ethereum app.</li>
            <li>Unlock MetaMask. Click the circle icon, select "Connect Hardware Wallet", choose Ledger, and follow the prompts.</li>
            <li>Select your Ledger ETH address in MetaMask; connect it to Hyperliquid by choosing MetaMask and then the Ledger-tagged account.</li>
            <li class="text-red-300">Store your Ledger 24-word Recovery Phrase offline, never digitally.</li>
          </ul>
          <div class="font-semibold">Task 3: Place a Test Order</div>
          <ul class="list-decimal pl-6">
            <li>On MEXC Futures, select BTC/USDT, use Limit order, price far from current, minimum amount, click Sell/Short, then Cancel.</li>
            <li>Repeat on Hyperliquid; approve via Ledger device when prompted.</li>
          </ul>
        </div>
        <!-- Applied Module 1 -->
        <div class="mb-4">
          <h4 class="text-xl font-bold text-blue-200">Applied Learning Module 1: Anatomy of a World-Class Short</h4>
          <div>Goal: Synthesize foundation lessons to build a high-conviction trade plan.</div>
          <ol class="list-decimal pl-6 mt-1">
            <li><span class="font-semibold">Target Acquisition:</span> On CoinGecko, filter for 24h Volume &gt; $2M, find Aetherium Prime ($AEP), down 82% from ATH, $5M volume.</li>
            <li><span class="font-semibold">Investigation:</span>
              <ul class="list-disc pl-7">
                <li><span class="underline">Narrative & Sentiment:</span> On LunarCrush, $AEP's social metrics have flatlined, sentiment is bearish.</li>
                <li><span class="underline">Tokenomics:</span> On token.unlocks.app, 20% supply unlock in 2 weeks‚Äîa bearish catalyst.</li>
                <li><span class="underline">Insider Wallets:</span> On Arkham Intelligence, a VC wallet is preparing to sell.</li>
              </ul>
            </li>
            <li><span class="font-semibold">Synthesis:</span> Write a thesis: "$AEP is a failed story coin, retail hype has died, and a 20% supply unlock for VCs is confirmed by on-chain prep to sell. High-probability short."</li>
            <li><span class="font-semibold">Tactical Plan:</span>
              <ul class="list-disc pl-7">
                <li>Chart: AEP/USDT on MEXC</li>
                <li>Entry: Limit sell at $2.00</li>
                <li>Stop-Loss: $2.20</li>
                <li>Position Size: 1% of $10,000 = 500 AEP</li>
              </ul>
            </li>
          </ol>
        </div>
      </div>
      <!-- ========== SHORT THESIS & DISCOVERY ========== -->
      <div>
        <h3 class="text-2xl font-bold text-yellow-200 mb-3">Phase 2: Short Thesis & Discovery</h3>
        <!-- Lesson 4 -->
        <div class="mb-4">
          <h4 class="text-xl font-bold text-pink-200 mb-1">Lesson 4: Short Thesis Discovery & Analysis</h4>
          <div>Task: Discover a "Failed Hype Cycle" Candidate</div>
          <ul class="list-decimal pl-6">
            <li>Go to www.dexscreener.com, click 'New Pairs'.</li>
            <li>Sort by '1h' gainers. Look for tokens up 500%+ with age a few hours.</li>
            <li>Bookmark and revisit in 24-48h. If price collapses, analyze in your journal.</li>
          </ul>
        </div>
        <!-- Lesson 5 -->
        <div class="mb-4">
          <h4 class="text-xl font-bold text-pink-200 mb-1">Lesson 5: Red Flags & Scam Spotting</h4>
          <div>Task: Spot a "Rug Pull" Red Flag</div>
          <ul class="list-decimal pl-6">
            <li>Find a new token on Dexscreener.</li>
            <li>Look for 'Liquidity is Locked'. Red box warnings about unlocked liquidity or high holder concentration are major red flags.</li>
            <li>Screenshot and journal the red flag.</li>
          </ul>
        </div>
        <!-- Applied Module 2 -->
        <div class="mb-4">
          <h4 class="text-xl font-bold text-blue-200">Applied Learning Module 2: A Tale of Two Red Flags</h4>
          <div>
            <b>Case 1:</b> The "Honeypot" Scam ‚Äî No SELL transactions, only BUYs, Dexscreener flags. "Too good to be true" = trap.<br>
            <b>Case 2:</b> The "Slow Rug" ‚Äî DeFi project down 95%, abandoned social, devs slowly cashing out. Journal these findings.
          </div>
        </div>
      </div>
      <!-- ========== EXECUTION & JOURNALING ========== -->
      <div>
        <h3 class="text-2xl font-bold text-yellow-200 mb-3">Phase 3: Execution & Journaling</h3>
        <!-- Lesson 6 -->
        <div class="mb-4">
          <h4 class="text-xl font-bold text-pink-200 mb-1">Lesson 6: Short Entry Execution</h4>
          <div>Task: Identify an Optimal Entry Point</div>
          <ul class="list-decimal pl-6">
            <li>On TradingView, load a pump-and-dump token's 1H chart.</li>
            <li>Mark horizontal support where price bounced up.</li>
            <li>Find where price crashed below that line (broken support).</li>
            <li>Optimal short entry is often a retest of the broken support from below.</li>
          </ul>
        </div>
        <!-- Lesson 7 -->
        <div class="mb-4">
          <h4 class="text-xl font-bold text-pink-200 mb-1">Lesson 7: Journaling for Improvement</h4>
          <div>This is the most important habit of any professional trader.</div>
          <ul class="list-decimal pl-6">
            <li>In a spreadsheet, create columns: Date, Asset, Thesis, Entry, SL, TP, Position Size, Outcome (W/L), P&L ($), Emotion/Psychology, Mistakes/Lessons.</li>
            <li>After every trade, fill out the journal‚Äîbe honest, especially about emotions and lessons.</li>
          </ul>
        </div>
        <!-- Applied Module 3 -->
        <div class="mb-4">
          <h4 class="text-xl font-bold text-blue-200">Applied Learning Module 3: From Plan to Action</h4>
          <div>
            <b>Scenario:</b> $AEP trade plan is active. Price rallies to $2.00.<br>
            <b>Execution:</b> On MEXC, Limit Sell 500 AEP at $2.00, TP $1.20, SL $2.20.<br>
            <b>Outcome:</b> TP hit at $1.20, +$400 profit.<br>
            <b>Journaling:</b> Asset: $AEP, Thesis: "Failed hype + VC unlock", Entry: $2.00, SL: $2.20, TP: $1.20, Outcome: Win, P&L: $400, Emotion: "Anxious, but trusted plan", Lesson: "Research edge is key."
          </div>
        </div>
      </div>
      <!-- ========== ADVANCED SCENARIOS & PSYCHOLOGY ========== -->
      <div>
        <h3 class="text-2xl font-bold text-yellow-200 mb-3">Phase 4: Advanced Scenarios & Psychology</h3>
        <!-- Lesson 8 -->
        <div class="mb-4">
          <h4 class="text-xl font-bold text-pink-200 mb-1">Lesson 8: Trader Psychology & FOMO</h4>
          <div>Task: Document FOMO ‚Äî When you feel the urge to chase a pump, pause and journal the feeling. Recognizing FOMO is the first step to control.</div>
        </div>
        <!-- Lesson 9 -->
        <div class="mb-4">
          <h4 class="text-xl font-bold text-pink-200 mb-1">Lesson 9: Dealing with Losses & Tilt</h4>
          <div>Task: Create a "Circuit Breaker"</div>
          <div>
            Example Rule: <span class="text-blue-300 italic">"If I lose 3 trades in a row, OR my account is down 2% in a day, I will shut down and not trade for 24h. No exceptions."</span>
          </div>
        </div>
        <!-- Applied Module 4 -->
        <div class="mb-4">
          <h4 class="text-xl font-bold text-blue-200">Applied Learning Module 4: The Losing Trade</h4>
          <div>
            <b>Scenario:</b> Short thesis on $BETA, but surprise positive news hits. Stop-loss triggered, lose 1%.<br>
            <b>Psych Response:</b> Initial anger, urge to revenge trade.<br>
            <b>Professional Process:</b> Recognize emotion ‚Üí execute "circuit breaker" ‚Üí log out ‚Üí journal trade and feelings.<br>
            <b>Lesson:</b> Losses happen outside your control. Journaling turns emotion into lesson and reinforces discipline.
          </div>
        </div>
      </div>
      <!-- ========== MASTERY & PEER REVIEW ========== -->
      <div>
        <h3 class="text-2xl font-bold text-yellow-200 mb-3">Phase 5: Mastery & Peer Review</h3>
        <!-- Lesson 10 -->
        <div class="mb-4">
          <h4 class="text-xl font-bold text-pink-200 mb-1">Lesson 10: Peer Review & Community</h4>
          <ul class="list-decimal pl-6">
            <li>Go to TradingView &gt; Community or Ideas tab.</li>
            <li>Find a published short idea for crypto. Read and critique in your journal.</li>
            <li class="text-blue-300 text-sm pl-7 italic">
              e.g. "Good bearish pattern, but thesis lacks tokenomics. Stop-loss too wide, poor R:R."
            </li>
          </ul>
        </div>
        <!-- Lesson 11 -->
        <div class="mb-4">
          <h4 class="text-xl font-bold text-pink-200 mb-1">Lesson 11: Final Project & Certification</h4>
          <div>
            <span class="font-semibold">Task:</span> Paper trade for 1 month. Log at least 10-15 trades with full journal entries. Review best/worst trades and write your final report as per syllabus. This is your certification for live trading.
          </div>
        </div>
        <!-- Applied Module 5 -->
        <div class="mb-4">
          <h4 class="text-xl font-bold text-blue-200">Applied Learning Module 5: From Trader to Analyst</h4>
          <div>
            <b>Scenario:</b> End of certification month, 12 paper trades, 7 winners, 5 losers, net P&L positive.<br>
            <b>Report:</b> Analyze one winning, one losing trade. Focus on execution and process, not outcome.<br>
            <b>Reflection:</b> "My biggest lesson: My job is to be a risk manager, not a predictor. Profits came from discipline and cutting losses. I am now ready for live trading with a professional process."
          </div>
        </div>
      </div>
      <!-- END PHASES -->
      <div class="text-center mt-10">
        <span class="inline-block text-lg text-green-300 font-bold">This manual is your edge. Revisit before every big trade. <span class="ml-2">üöÄ</span></span>
      </div>
    </div>
  </div>
  <!-- FontAwesome for icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css">
  <style>
    .manual-section ul { margin-bottom: 0; }
    .manual-section h3 { letter-spacing: 0.01em; }
    .manual-section { font-family: 'Montserrat', system-ui, sans-serif; }
    .manual-section h4 { margin-top: 0.75rem; }
    .manual-section ol, .manual-section ul { margin-top: 0.3rem; }
  </style>
</section>
<!-- Trading Journal & Syllabus Pro: Now with Dashboard Sync -->
<section id="journalContent" class="hidden">
  <div class="manual-section p-8 rounded-xl shadow mb-8 mx-auto" style="max-width:100rem;">

    <!-- HEADER + BADGES/PROGRESS -->
    <div class="flex flex-col md:flex-row items-center gap-8">
      <div class="md:w-2/3">
        <h2 class="text-3xl font-extrabold mb-3 text-blue-200">Trading Journal</h2>
        <ul class="mt-4 list-disc ml-8 text-blue-50 text-base space-y-1">
          <li>Log every trade with full details, outcome, emotions, and lessons learned.</li>
          <li>Phase progress and badges unlock as you journal. See your stats, compete on the leaderboard!</li>
        </ul>
        <div class="mt-6 bg-blue-700/80 border-l-4 border-blue-300 px-4 py-3 rounded">
          <b class="text-yellow-100">Tip:</b>
          <span class="text-blue-100">
            Consistent journaling is the #1 habit of professional traders. Use this as your edge!
          </span>
        </div>
      </div>
      <div class="md:w-1/3 flex flex-col items-center gap-3">
        <div class="w-full mb-3">
          <div class="flex items-center gap-2 mb-1">
            <span class="text-yellow-100 font-bold text-base"><i class="fas fa-chart-line"></i> Progress</span>
            <span id="journal-progress-label" class="ml-auto text-blue-200 text-xs"></span>
          </div>
          <div class="w-full bg-blue-900/60 rounded-full h-6 shadow relative">
            <div id="journal-progress-bar" class="bg-gradient-to-r from-yellow-400 to-green-300 h-6 rounded-full transition-all" style="width:0%"></div>
          </div>
        </div>
        <div class="flex flex-wrap gap-2 justify-center mt-1" id="journal-badges"></div>
      </div>
    </div>

    <!-- PHASES & PHASE-STATS -->
    <div class="mt-8 mb-8 p-6 rounded-xl bg-[#21243b] border border-blue-900 shadow-lg" style="max-width:64rem;margin:auto;">
      <h3 class="text-xl font-bold text-yellow-100 flex items-center gap-2 mb-3"><i class="fas fa-graduation-cap"></i> Syllabus Phase Progress</h3>
      <div id="syllabus-phase-list" class="flex flex-col gap-4"></div>
      <div class="mt-6">
        <h4 class="text-lg text-blue-100 font-bold mb-2 flex items-center gap-2"><i class="fas fa-chart-pie"></i> Phase-Specific Journal Stats</h4>
        <div id="phase-journal-stats" class="flex flex-wrap gap-4"></div>
      </div>
    </div>

    <!-- LEADERBOARD -->
    <div class="mt-2 mb-8 p-6 rounded-xl bg-[#181e2a] border border-blue-900 shadow-lg" style="max-width:64rem;margin:auto;">
      <h3 class="text-lg font-bold text-yellow-100 flex items-center gap-2 mb-3"><i class="fas fa-trophy"></i> Leaderboard: Top Journalers (Device Only)</h3>
      <div id="journal-leaderboard" class="flex flex-col gap-1"></div>
      <div class="text-xs text-blue-100 mt-2">* This leaderboard is stored only in your browser (local device/sandbox).</div>
    </div>

    <!-- JOURNAL ENTRY FORM -->
    <div class="mt-12 mb-6 bg-[#232946] p-6 rounded-lg border border-blue-900 shadow-2xl mx-auto"
         style="max-width:80rem;min-width:340px;overflow-x:auto;">
      <h3 class="text-xl font-bold text-blue-100 mb-4">New Trade Entry</h3>
      <form id="journalForm" class="grid grid-cols-1 md:grid-cols-4 gap-4 journal-form" autocomplete="off">
        <div>
          <label class="block mb-1" for="journal-date">Date</label>
          <input type="date" id="journal-date" required class="w-full" />
        </div>
        <div>
          <label class="block mb-1" for="journal-asset">Asset</label>
          <input type="text" id="journal-asset" placeholder="e.g. BTC/USDT" required class="w-full" />
        </div>
        <div>
          <label class="block mb-1" for="journal-direction">Direction</label>
          <select id="journal-direction" required class="w-full">
            <option value="Long">Long</option>
            <option value="Short">Short</option>
          </select>
        </div>
        <div>
          <label class="block mb-1" for="journal-phase">Phase</label>
          <select id="journal-phase" required class="w-full">
            <option value="Foundation">Foundation</option>
            <option value="Short Thesis & Discovery">Short Thesis & Discovery</option>
            <option value="Execution & Journaling">Execution & Journaling</option>
            <option value="Advanced Scenarios & Psychology">Advanced Scenarios & Psychology</option>
            <option value="Mastery & Peer Review">Mastery & Peer Review</option>
          </select>
        </div>
        <div>
          <label class="block mb-1" for="edit-phase">Phase</label>
          <select id="edit-phase" required class="w-full">
            <option value="Foundation">Foundation</option>
            <option value="Short Thesis & Discovery">Short Thesis & Discovery</option>
            <option value="Execution & Journaling">Execution & Journaling</option>
            <option value="Advanced Scenarios & Psychology">Advanced Scenarios & Psychology</option>
            <option value="Mastery & Peer Review">Mastery & Peer Review</option>
          </select>
        </div>
        <div>
          <label class="block mb-1" for="journal-thesis">Trade Thesis</label>
          <input type="text" id="journal-thesis" placeholder="Brief reason" required class="w-full" />
        </div>
        <div>
          <label class="block mb-1" for="journal-entry">Entry Price</label>
          <input type="number" step="any" id="journal-entry" required class="w-full" min="0.00000001" />
        </div>
        <div>
          <label class="block mb-1" for="journal-exit">Exit Price</label>
          <input type="number" step="any" id="journal-exit" required class="w-full" min="0.00000001" />
        </div>
        <div>
          <label class="block mb-1" for="journal-sl">Stop Loss</label>
          <input type="number" step="any" id="journal-sl" class="w-full" min="0" />
        </div>
        <div>
          <label class="block mb-1" for="journal-tp">Take Profit</label>
          <input type="number" step="any" id="journal-tp" class="w-full" min="0" />
        </div>
        <div>
          <label class="block mb-1" for="journal-size">Position Size</label>
          <input type="number" step="any" id="journal-size" required class="w-full" min="0.00000001" />
        </div>
        <div>
          <label class="block mb-1" for="journal-outcome">Outcome</label>
          <select id="journal-outcome" required class="w-full">
            <option value="Win">Win</option>
            <option value="Loss">Loss</option>
            <option value="Breakeven">Breakeven</option>
          </select>
        </div>
        <div>
          <label class="block mb-1" for="journal-pnl">P&amp;L ($)</label>
          <input type="number" step="any" id="journal-pnl" readonly tabindex="-1" style="background: #28304a !important; opacity:0.7;" class="w-full" />
        </div>
        <div>
          <label class="block mb-1" for="journal-emotion">Emotion/Psychology</label>
          <input type="text" id="journal-emotion" placeholder="e.g. FOMO, confident..." class="w-full" />
        </div>
        <div class="md:col-span-4">
          <label class="block mb-1" for="journal-mistakes">Mistakes/Lessons Learned</label>
          <textarea id="journal-mistakes" rows="2" class="w-full"></textarea>
        </div>
        <div class="md:col-span-4 flex gap-2 mt-2 flex-wrap justify-end min-w-[320px]">
          <button type="submit" class="bg-blue-700 hover:bg-blue-800 text-white font-bold px-6 py-2 rounded shadow transition">Add Entry</button>
          <button type="button" id="journalClearBtn" class="bg-red-600 hover:bg-red-700 text-white font-bold px-6 py-2 rounded shadow transition ml-2" title="Clear all journal entries">Clear All</button>
          <button type="button" id="journalExportBtn" class="bg-yellow-500 hover:bg-yellow-600 text-blue-900 font-bold px-6 py-2 rounded shadow transition ml-2" title="Export journal to CSV">Export CSV</button>
        </div>
        <div id="journal-message" class="col-span-4 mt-2 text-green-300 font-semibold"></div>
      </form>
    </div>
<!-- JOURNAL TABLE & FILTERS -->
<div class="mb-6 flex flex-col md:flex-row gap-8 items-center">
  <div class="w-full md:w-2/3">
    <div class="bg-blue-900/80 border-l-4 border-blue-400 px-4 py-3 rounded text-blue-100 font-mono font-semibold mb-2">
      <span id="journal-progress">No entries yet.</span>
    </div>
  </div>
  <div class="w-full md:w-1/3">
    <div class="flex gap-2 items-center justify-end">
      <label for="journal-filter-phase" class="text-blue-100">Phase:</label>
      <select id="journal-filter-phase" class="px-2 py-1 rounded">
        <option value="All">All</option>
        <option value="Foundation">Foundation</option>
        <option value="Short Thesis & Discovery">Short Thesis & Discovery</option>
        <option value="Execution & Journaling">Execution & Journaling</option>
        <option value="Advanced Scenarios & Psychology">Advanced Scenarios & Psychology</option>
        <option value="Mastery & Peer Review">Mastery & Peer Review</option>
      </select>
      <label for="journal-filter-outcome" class="text-blue-100 ml-2">Filter:</label>
      <select id="journal-filter-outcome" class="px-2 py-1 rounded">
        <option value="All">All</option>
        <option value="Win">Wins</option>
        <option value="Loss">Losses</option>
        <option value="Breakeven">Breakeven</option>
      </select>
    </div>
  </div>
</div>
<!-- PASTE THE TABLE BLOCK RIGHT HERE! -->
<div class="overflow-x-auto mt-3">
  <table class="min-w-full bg-[#181e2a] rounded-lg overflow-x-auto text-blue-100">
    <thead>
      <tr>
        <th>Date</th>
        <th>Asset</th>
        <th>Direction</th>
        <th>Phase</th>
        <th>Thesis</th>
        <th>Entry</th>
        <th>Exit</th>
        <th>SL</th>
        <th>TP</th>
        <th>Size</th>
        <th>Outcome</th>
        <th>PNL</th>
        <th>Emotion</th>
        <th>Mistakes</th>
      </tr>
    </thead>
    <tbody id="journal-table-body"></tbody>
  </table>
</div>
</section>
 <!-- Dashboard -->
<!-- DASHBOARD SECTION: Clean, Synced, Standalone, Paste-Ready -->
<section id="dashboardContent" class="hidden">
  <div class="dashboard-section p-8 rounded-xl shadow mb-8 mx-auto max-w-7xl">
    <h2 class="text-3xl font-extrabold mb-3 text-blue-200">Dashboard Overview</h2>
    <ul class="mt-4 list-disc ml-8 text-blue-50 text-base space-y-1">
      <li>Visualize your trading performance, risk, and consistency.</li>
      <li>Interactive filters and analytics‚Äîsee stats by date, asset, or direction.</li>
      <li>Charts are large and styled for professional clarity.</li>
    </ul>
    <div class="mt-6 bg-blue-700/80 border-l-4 border-blue-300 px-4 py-3 rounded">
      <b class="text-yellow-100">Tip:</b>
      <span class="text-blue-100">
        Use the Dashboard to spot your edge, weaknesses, and review after every session!
      </span>
    </div>

    <!-- FILTERS -->
    <div class="mt-10 mb-8 flex flex-wrap gap-4 items-center bg-blue-800/70 rounded-lg p-4">
      <label class="text-blue-100 font-semibold" for="db-filter-asset">Asset:</label>
      <select id="db-filter-asset" class="px-2 py-1 rounded text-base bg-blue-900 text-blue-100 border border-blue-700"></select>
      <label class="text-blue-100 font-semibold" for="db-filter-direction">Direction:</label>
      <select id="db-filter-direction" class="px-2 py-1 rounded text-base bg-blue-900 text-blue-100 border border-blue-700">
        <option value="">All</option>
        <option value="Long">Long</option>
        <option value="Short">Short</option>
      </select>
      <label class="text-blue-100 font-semibold" for="db-filter-datefrom">From:</label>
      <input type="date" id="db-filter-datefrom" class="px-2 py-1 rounded text-base bg-blue-900 text-blue-100 border border-blue-700"/>
      <label class="text-blue-100 font-semibold" for="db-filter-dateto">To:</label>
      <input type="date" id="db-filter-dateto" class="px-2 py-1 rounded text-base bg-blue-900 text-blue-100 border border-blue-700"/>
      <button id="db-filter-reset" class="ml-4 px-4 py-1 bg-blue-700 hover:bg-blue-800 text-blue-100 rounded font-bold text-sm transition">Reset</button>
    </div>

    <!-- Dashboard Stats -->
    <div class="mt-6 grid grid-cols-1 md:grid-cols-4 gap-8">
      <div class="stat-card bg-blue-800/80 text-blue-100 rounded-lg p-6 flex flex-col items-center shadow">
        <div class="text-4xl font-extrabold" id="db-total-trades">0</div>
        <div class="mt-2 uppercase text-blue-300 tracking-wide font-bold text-xs">Total Trades</div>
      </div>
      <div class="stat-card bg-blue-800/80 text-blue-100 rounded-lg p-6 flex flex-col items-center shadow">
        <div class="text-4xl font-extrabold text-green-300" id="db-win-rate">0%</div>
        <div class="mt-2 uppercase text-blue-300 tracking-wide font-bold text-xs">Win Rate</div>
      </div>
      <div class="stat-card bg-blue-800/80 text-blue-100 rounded-lg p-6 flex flex-col items-center shadow">
        <div class="text-4xl font-extrabold text-yellow-300" id="db-pnl">0</div>
        <div class="mt-2 uppercase text-blue-300 tracking-wide font-bold text-xs">Net P&amp;L ($)</div>
      </div>
      <div class="stat-card bg-blue-800/80 text-blue-100 rounded-lg p-6 flex flex-col items-center shadow">
        <div class="text-4xl font-extrabold text-pink-300" id="db-max-drawdown">0</div>
        <div class="mt-2 uppercase text-blue-300 tracking-wide font-bold text-xs">Max Drawdown</div>
      </div>
    </div>

    <!-- Dashboard Charts -->
    <div class="mt-12 grid grid-cols-1 xl:grid-cols-2 gap-10">
      <div class="bg-[#232946] rounded-lg p-6 shadow-lg flex flex-col min-h-[420px]">
        <div class="text-lg font-bold text-blue-100 mb-3">Equity Curve</div>
        <canvas id="db-equity-curve" height="300"></canvas>
      </div>
      <div class="bg-[#232946] rounded-lg p-6 shadow-lg flex flex-col min-h-[420px]">
        <div class="text-lg font-bold text-blue-100 mb-3">Trades by Outcome</div>
        <canvas id="db-pie-outcome" height="300"></canvas>
      </div>
      <div class="bg-[#232946] rounded-lg p-6 shadow-lg flex flex-col min-h-[420px]">
        <div class="text-lg font-bold text-blue-100 mb-3">P&amp;L by Asset</div>
        <canvas id="db-bar-asset" height="300"></canvas>
      </div>
      <div class="bg-[#232946] rounded-lg p-6 shadow-lg flex flex-col min-h-[420px]">
        <div class="text-lg font-bold text-blue-100 mb-3">Long vs Short Win Rate</div>
        <canvas id="db-bar-longshort" height="300"></canvas>
      </div>
      <div class="bg-[#232946] rounded-lg p-6 shadow-lg flex flex-col min-h-[420px] xl:col-span-2">
        <div class="text-lg font-bold text-blue-100 mb-3">Monthly Performance</div>
        <canvas id="db-bar-month" height="300"></canvas>
      </div>
      <div class="bg-[#232946] rounded-lg p-6 shadow-lg flex flex-col min-h-[420px] xl:col-span-2">
        <div class="text-lg font-bold text-blue-100 mb-3">Largest Wins &amp; Losses</div>
        <canvas id="db-bar-bigtrades" height="300"></canvas>
      </div>
    </div>

    <!-- Dashboard Table: Top Mistakes & Lessons -->
    <div class="mt-12 bg-blue-800/80 rounded-lg shadow-lg p-6">
      <div class="text-lg font-bold text-yellow-200 mb-3">Most Frequent Mistakes &amp; Lessons</div>
      <ul id="db-mistakes-list" class="list-disc pl-8 text-blue-100 text-base space-y-2"></ul>
    </div>
  </div>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css">
  <style>
    .dashboard-section {
      font-family: 'Montserrat', system-ui, sans-serif;
    }
    .stat-card {
      min-width: 0;
      min-height: 120px;
      background: linear-gradient(120deg, #232946 60%, #2e3866 100%);
      border: 1px solid #2e3866;
    }
    canvas {
      background: transparent;
      width: 100% !important;
      height: 320px !important;
      max-width: 100%;
      display: block;
    }
    #db-mistakes-list li {
      border-left: 4px solid #facc15;
      padding-left: 0.75rem;
      background: #28304a44;
      border-radius: 0.25rem;
      margin-bottom: 0.5rem;
    }
    .min-h-\[420px\] { min-height: 420px; }
    @media (max-width: 900px) {
      .dashboard-section { padding: 1rem !important; }
      .stat-card { padding: 1.5rem 0.7rem; }
      .min-h-\[420px\] { min-height: 300px; }
      canvas { height: 200px !important; }
    }
    @media (max-width: 600px) {
      .stat-card { min-height: 80px; }
      .min-h-\[420px\] { min-height: 180px; }
      canvas { height: 120px !important; }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script>
    // --- ENSURE JOURNAL_KEY IS GLOBAL ---
    window.JOURNAL_KEY = window.JOURNAL_KEY || "griffinsrise_journal_v1";
    function getJournal() {
      const data = localStorage.getItem(window.JOURNAL_KEY);
      return data ? JSON.parse(data) : [];
    }
    function safeNum(n) { n = Number(n); return isNaN(n) ? 0 : n; }
    function unique(arr) { return [...new Set(arr.filter(Boolean))]; }

    // --- FILTERS ---
    function getDashboardFilters() {
      return {
        asset: document.getElementById("db-filter-asset").value || "",
        direction: document.getElementById("db-filter-direction").value || "",
        dateFrom: document.getElementById("db-filter-datefrom").value || "",
        dateTo: document.getElementById("db-filter-dateto").value || ""
      };
    }
    function filterJournal(journal, filters) {
      return journal.filter(e => {
        if(filters.asset && e.asset !== filters.asset) return false;
        if(filters.direction && e.direction !== filters.direction) return false;
        if(filters.dateFrom && e.date && e.date < filters.dateFrom) return false;
        if(filters.dateTo && e.date && e.date > filters.dateTo) return false;
        return true;
      });
    }

    // --- STATS/CHARTS ---
    function calcStats(journal) {
      let stats = {
        total: 0,
        wins: 0,
        losses: 0,
        breakevens: 0,
        winRate: 0,
        pnl: 0,
        maxDrawdown: 0,
        equity: [],
        pie: {Win:0, Loss:0, Breakeven:0},
        byAsset: {},
        byDirection: {Long: {win:0, total:0}, Short:{win:0, total:0}},
        byMonth: {},
        bigWins: [],
        bigLosses: [],
        mistakes: [],
      };
      let eq = 0, maxPeak = 0, maxDD = 0, dd = 0;
      journal = journal.slice().reverse();  // oldest to newest for equity
      journal.forEach(e => {
        let p = safeNum(e.pnl);
        eq += p;
        stats.equity.push(eq);
        if(eq > maxPeak) maxPeak = eq;
        dd = maxPeak - eq;
        if(dd > maxDD) maxDD = dd;
        stats.total++;
        if(e.outcome === "Win") stats.wins++;
        else if(e.outcome === "Loss") stats.losses++;
        else if(e.outcome === "Breakeven") stats.breakevens++;
        stats.pie[e.outcome] = (stats.pie[e.outcome]||0)+1;
        stats.byAsset[e.asset] = (stats.byAsset[e.asset]||0) + p;
        if(e.direction === "Long" || e.direction === "Short") {
          stats.byDirection[e.direction].total++;
          if(e.outcome === "Win") stats.byDirection[e.direction].win++;
        }
        if(e.date && /^[0-9]{4}-[0-9]{2}/.test(e.date)) {
          const ym = e.date.slice(0,7);
          stats.byMonth[ym] = (stats.byMonth[ym]||0) + p;
        }
        if(typeof p === 'number') {
          if(p > 0) stats.bigWins.push({date:e.date||"", pnl:p, asset:e.asset||""});
          else if(p < 0) stats.bigLosses.push({date:e.date||"", pnl:p, asset:e.asset||""});
        }
        if(e.mistakes) stats.mistakes.push(e.mistakes.trim());
      });
      stats.winRate = stats.total ? (stats.wins / stats.total * 100).toFixed(1) : 0;
      stats.pnl = eq;
      stats.maxDrawdown = maxDD;
      stats.bigWins = stats.bigWins.sort((a,b)=>b.pnl-a.pnl).slice(0,5);
      stats.bigLosses = stats.bigLosses.sort((a,b)=>a.pnl-b.pnl).slice(0,5);
      return stats;
    }

    // --- RENDER DASHBOARD ---
    function renderDashboard() {
      const allJournal = getJournal();
      // Populate asset dropdown
      const assetSel = document.getElementById("db-filter-asset");
      const currentAsset = assetSel.value;
      const assets = unique(allJournal.map(e=>e.asset));
      assetSel.innerHTML = '<option value="">All</option>' + assets.map(a=>`<option>${a}</option>`).join('');
      assetSel.value = currentAsset; // Retain selection

      // Apply filters
      const filters = getDashboardFilters();
      const journal = filterJournal(allJournal, filters);
      const stats = calcStats(journal);

      // Stats
      document.getElementById("db-total-trades").textContent = stats.total;
      document.getElementById("db-win-rate").textContent = stats.winRate + "%";
      document.getElementById("db-pnl").textContent = (stats.pnl >= 0 ? "+" : "") + stats.pnl.toFixed(2);
      document.getElementById("db-max-drawdown").textContent = "-" + stats.maxDrawdown.toFixed(2);

      // --- CHART COLORS ---
      const chartColors = {
        blue: "#38bdf8",
        green: "#22d3ee",
        lightGreen: "#4ade80",
        yellow: "#eab308",
        orange: "#f59e42",
        red: "#ef4444",
        pink: "#e879f9",
        purple: "#a78bfa",
        bg: "rgba(56,189,248,0.12)",
        gray: "#64748b",
        dark: "#232946"
      };

      // --- Equity Curve ---
      if(window.dbEqChart) window.dbEqChart.destroy();
      const eqLabels = journal.map((e,i)=>e.date||("T"+(i+1)));
      window.dbEqChart = new Chart(document.getElementById("db-equity-curve"), {
        type: 'line',
        data: {
          labels: eqLabels,
          datasets: [{
            label: "Equity",
            data: stats.equity,
            fill: true,
            borderColor: chartColors.blue,
            backgroundColor: chartColors.bg,
            pointRadius: 3,
            pointBackgroundColor: chartColors.yellow,
            tension: 0.22
          }]
        },
        options: {
          plugins: {legend: {display:false}, tooltip: {mode:'index', intersect:false, titleColor:'#fff', bodyColor:'#fff'}},
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: { display: true, ticks:{color:chartColors.gray}, grid:{color:'#28304a'}, title:{display:true,text:'Trade'} },
            y: { beginAtZero: true, grid: {color:'#28304a'}, ticks:{color:chartColors.gray} }
          }
        }
      });

      // --- Pie Chart by Outcome ---
      if(window.dbPieChart) window.dbPieChart.destroy();
      window.dbPieChart = new Chart(document.getElementById("db-pie-outcome"), {
        type: 'doughnut',
        data: {
          labels: ["Win", "Loss", "Breakeven"],
          datasets: [{
            data: [stats.pie.Win||0, stats.pie.Loss||0, stats.pie.Breakeven||0],
            backgroundColor: [chartColors.lightGreen, chartColors.red, chartColors.yellow],
            borderColor: chartColors.dark,
            borderWidth: 2
          }]
        },
        options: {
          plugins: { 
            legend: {labels:{color:chartColors.gray, font:{weight:'bold'}}},
            tooltip: {callbacks:{
              label: ctx => ctx.label+": "+ctx.parsed+" ("+((ctx.parsed/stats.total*100)||0).toFixed(1)+"%)"
            }},
          },
          cutout: "60%",
          responsive: true,
          maintainAspectRatio: false,
        }
      });

      // --- Bar: P&L by Asset ---
      if(window.dbAssetChart) window.dbAssetChart.destroy();
      const assetLabels = Object.keys(stats.byAsset);
      const assetData = assetLabels.map(k=>stats.byAsset[k]);
      window.dbAssetChart = new Chart(document.getElementById("db-bar-asset"), {
        type: 'bar',
        data: {
          labels: assetLabels,
          datasets: [{
            label: "Net P&L",
            data: assetData,
            backgroundColor: assetData.map(v=>v>=0?chartColors.green:chartColors.red)
          }]
        },
        options: {
          plugins: { legend: {display:false} },
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: { ticks:{color:chartColors.gray}, grid:{color:'#28304a'} },
            y: { beginAtZero:true, ticks:{color:chartColors.gray}, grid:{color:'#28304a'} }
          }
        }
      });

      // --- Bar: Long vs Short Win Rate ---
      if(window.dbLongShortChart) window.dbLongShortChart.destroy();
      const dirs = ["Long","Short"];
      const wr = dirs.map(d=>stats.byDirection[d].total?stats.byDirection[d].win/stats.byDirection[d].total*100:0);
      window.dbLongShortChart = new Chart(document.getElementById("db-bar-longshort"), {
        type: 'bar',
        data: {
          labels: dirs,
          datasets: [{
            label: "Win Rate (%)",
            data: wr,
            backgroundColor: [chartColors.blue,chartColors.pink]
          }]
        },
        options: {
          plugins: { legend: {display:false} },
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: { ticks:{color:chartColors.gray}, grid:{color:'#28304a'} },
            y: { beginAtZero:true, max:100, ticks:{color:chartColors.gray}, grid:{color:'#28304a'} }
          }
        }
      });

      // --- Monthly Performance Bar ---
      if(window.dbMonthChart) window.dbMonthChart.destroy();
      const months = Object.keys(stats.byMonth).sort();
      const monthVals = months.map(m=>stats.byMonth[m]);
      window.dbMonthChart = new Chart(document.getElementById("db-bar-month"), {
        type: 'bar',
        data: {
          labels: months,
          datasets: [{
            label: "Monthly P&L",
            data: monthVals,
            backgroundColor: monthVals.map(v=>v>=0?chartColors.lightGreen:chartColors.red)
          }]
        },
        options: {
          plugins: { legend: {display:false} },
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: { ticks:{color:chartColors.gray}, grid:{color:'#28304a'} },
            y: { beginAtZero:true, ticks:{color:chartColors.gray}, grid:{color:'#28304a'} }
          }
        }
      });

      // --- Big Trades (Top 5 Wins & Losses) ---
      if(window.dbBigChart) window.dbBigChart.destroy();
      const bigLabels = [
        ...stats.bigWins.map(e=>`+${e.pnl.toFixed(2)} ${e.asset} [${e.date}]`),
        ...stats.bigLosses.map(e=>`${e.pnl.toFixed(2)} ${e.asset} [${e.date}]`)
      ];
      const bigData = [
        ...stats.bigWins.map(e=>e.pnl),
        ...stats.bigLosses.map(e=>e.pnl)
      ];
      window.dbBigChart = new Chart(document.getElementById("db-bar-bigtrades"), {
        type: 'bar',
        data: {
          labels: bigLabels,
          datasets: [{
            label: "Biggest Wins/Losses",
            data: bigData,
            backgroundColor: [
              ...stats.bigWins.map(e=>chartColors.lightGreen),
              ...stats.bigLosses.map(e=>chartColors.red)
            ]
          }]
        },
        options: {
          plugins: { legend: {display:false} },
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: { ticks:{color:chartColors.gray, autoSkip:false, maxRotation:60, minRotation:30}, grid:{color:'#28304a'} },
            y: { ticks:{color:chartColors.gray}, grid:{color:'#28304a'} }
          }
        }
      });

      // Top Mistakes/Lessons
      const mistakesList = document.getElementById("db-mistakes-list");
      mistakesList.innerHTML = "";
      if(stats.mistakes.length) {
        let freq = {};
        stats.mistakes.filter(Boolean).forEach(m=>{
          m.split(/[.;\n]/).map(x=>x.trim()).filter(x=>x).forEach(line=>{
            freq[line] = (freq[line]||0)+1;
          });
        });
        const top = Object.entries(freq)
          .sort((a,b)=>b[1]-a[1])
          .slice(0,7)
          .map(([txt,count])=>`<li><b>${count}√ó</b> ${txt}</li>`).join('');
        mistakesList.innerHTML = top || "<li>No mistakes/lessons recorded.</li>";
      } else {
        mistakesList.innerHTML = "<li>No mistakes/lessons recorded.</li>";
      }
    }

    function setupDashboardFilters() {
      document.getElementById("db-filter-reset").onclick = function() {
        document.getElementById("db-filter-asset").value = "";
        document.getElementById("db-filter-direction").value = "";
        document.getElementById("db-filter-datefrom").value = "";
        document.getElementById("db-filter-dateto").value = "";
        renderDashboard();
      };
      ["db-filter-asset","db-filter-direction","db-filter-datefrom","db-filter-dateto"].forEach(id => {
        document.getElementById(id).onchange = renderDashboard;
      });
    }

    document.addEventListener("DOMContentLoaded", ()=>{
      setupDashboardFilters();
      renderDashboard();
    });

    // Make renderDashboard available globally for journal sync
    window.renderDashboard = renderDashboard;
  </script>
</section>
</main>
<footer class="bg-[#232946] text-blue-200 py-4 mt-6 text-center border-t border-blue-900 font-semibold text-base shadow">
  &copy; 2025 Griffin's Rise: Advanced Trading Journal Pro Edition | Powered by Copilot & TailwindCSS
</footer>
<script>
/* ========= LOGIN & NAVIGATION JS ========= */

// ---- Tab & Content Elements ----
const educationTab = document.getElementById("educationTab");
const syllabusTab = document.getElementById("syllabusTab");
const trainingManualTab = document.getElementById("trainingManualTab");
const journalTab = document.getElementById("journalTab");
const dashboardTab = document.getElementById("dashboardTab");
const loginTab = document.getElementById("loginTab");
const logoutBtn = document.getElementById("logoutBtn");
const educationContent = document.getElementById("educationContent");
const syllabusContent = document.getElementById("syllabusContent");
const trainingManualContent = document.getElementById("trainingManualContent");
const journalContent = document.getElementById("journalContent");
const dashboardContent = document.getElementById("dashboardContent");
const loginContent = document.getElementById("loginContent");
const loginForm = document.getElementById("loginForm");
const registerForm = document.getElementById("registerForm");
const switchToRegister = document.getElementById("switchToRegister");
const switchToLogin = document.getElementById("switchToLogin");
const loginMessage = document.getElementById("loginMessage");

// ---- Auth State ----
function setLoggedIn(loggedIn, username="") {
  localStorage.setItem("loggedIn", loggedIn ? "yes" : "no");
  if (loggedIn && username) {
    localStorage.setItem("username", username);
  } else {
    localStorage.removeItem("username");
  }
}
function isLoggedIn() {
  return localStorage.getItem("loggedIn") === "yes";
}

// ---- Nav/UI Update ----
function updateNavForLogin() {
  const navButtons = [educationTab, syllabusTab, trainingManualTab, journalTab, dashboardTab];
  if (!isLoggedIn()) {
    navButtons.forEach(btn => btn && btn.classList.add("hidden"));
    if (loginTab) loginTab.classList.remove("hidden");
    if (logoutBtn) logoutBtn.classList.add("hidden");
    showTab("login");
  } else {
    navButtons.forEach(btn => btn && btn.classList.remove("hidden"));
    if (loginTab) loginTab.classList.add("hidden");
    if (logoutBtn) logoutBtn.classList.remove("hidden");
    showTab("education");
  }
}
function showTab(tab) {
  [educationTab, syllabusTab, trainingManualTab, journalTab, dashboardTab, loginTab].forEach(btn => btn && btn.classList.remove("tab-active"));
  educationContent && educationContent.classList.add("hidden");
  syllabusContent && syllabusContent.classList.add("hidden");
  trainingManualContent && trainingManualContent.classList.add("hidden");
  journalContent && journalContent.classList.add("hidden");
  dashboardContent && dashboardContent.classList.add("hidden");
  loginContent && loginContent.classList.add("hidden");
  if (tab === "education") {educationContent && educationContent.classList.remove("hidden"); educationTab && educationTab.classList.add("tab-active");}
  if (tab === "syllabus") {syllabusContent && syllabusContent.classList.remove("hidden"); syllabusTab && syllabusTab.classList.add("tab-active");}
  if (tab === "trainingManual") {trainingManualContent && trainingManualContent.classList.remove("hidden"); trainingManualTab && trainingManualTab.classList.add("tab-active");}
  if (tab === "journal") {journalContent && journalContent.classList.remove("hidden"); journalTab && journalTab.classList.add("tab-active");}
  if (tab === "dashboard") {dashboardContent && dashboardContent.classList.remove("hidden"); dashboardTab && dashboardTab.classList.add("tab-active");}
  if (tab === "login") {loginContent && loginContent.classList.remove("hidden"); loginTab && loginTab.classList.add("tab-active");}
  window.scrollTo({top:0,behavior:'smooth'});
}

// ---- Nav Button Handlers ----
if (educationTab) educationTab.addEventListener("click", () => showTab("education"));
if (syllabusTab) syllabusTab.addEventListener("click", () => showTab("syllabus"));
if (trainingManualTab) trainingManualTab.addEventListener("click", () => showTab("trainingManual"));
if (journalTab) journalTab.addEventListener("click", () => showTab("journal"));
if (dashboardTab) dashboardTab.addEventListener("click", () => showTab("dashboard"));
if (loginTab) loginTab.addEventListener("click", () => showTab("login"));
if (logoutBtn) logoutBtn.onclick = function() { setLoggedIn(false); updateNavForLogin(); };

// ---- Register/Login Toggle ----
if (switchToRegister) {
  switchToRegister.onclick = function() {
    loginForm && loginForm.classList.add("hidden");
    registerForm && registerForm.classList.remove("hidden");
    loginMessage && (loginMessage.textContent = "");
  };
}
if (switchToLogin) {
  switchToLogin.onclick = function() {
    registerForm && registerForm.classList.add("hidden");
    loginForm && loginForm.classList.remove("hidden");
    loginMessage && (loginMessage.textContent = "");
  };
}

// ---- Login Handler ----
if (loginForm) {
  loginForm.onsubmit = function(e) {
    e.preventDefault();
    const username = document.getElementById("login-username").value;
    setLoggedIn(true, username);
    updateNavForLogin();
    if (loginMessage) {
      loginMessage.textContent = "Logged in as " + username + "!";
      loginMessage.classList.remove("text-red-600");
      loginMessage.classList.add("text-green-400");
      setTimeout(() => { loginMessage.textContent = ""; }, 1200);
    }
  };
}

// ---- Register Handler ----
if (registerForm) {
  registerForm.onsubmit = function(e) {
    e.preventDefault();
    const user = document.getElementById("register-username").value;
    const pass = document.getElementById("register-password").value;
    const conf = document.getElementById("register-confirm").value;
    if (pass !== conf) {
      loginMessage.textContent = "Passwords do not match!";
      loginMessage.classList.remove("text-green-400");
      loginMessage.classList.add("text-red-600");
      return;
    }
    setLoggedIn(true, user);
    updateNavForLogin();
    loginMessage.textContent = "Registered as " + user + "!";
    loginMessage.classList.remove("text-red-600");
    loginMessage.classList.add("text-green-400");
    setTimeout(() => {
      loginMessage.textContent = "";
    }, 1200);
  };
}

// ---- On Page Load ----
updateNavForLogin();


</script>
<script>
// --- Auto-calculate PNL ---
function autoCalcJournalPNL() {
  const entry = parseFloat(document.getElementById("journal-entry").value || "0");
  const exit = parseFloat(document.getElementById("journal-exit").value || "0");
  const size = parseFloat(document.getElementById("journal-size").value || "0");
  const direction = document.getElementById("journal-direction").value;
  let pnl = 0;
  if (direction === "Long") pnl = (exit - entry) * size;
  else if (direction === "Short") pnl = (entry - exit) * size;
  document.getElementById("journal-pnl").value = pnl.toFixed(2);
}
["journal-entry", "journal-exit", "journal-size", "journal-direction"].forEach(id => {
  const el = document.getElementById(id);
  if (el) el.addEventListener("input", autoCalcJournalPNL);
});

// --- Add Entry Handler ---
document.getElementById("journalForm").onsubmit = function(e) {
  e.preventDefault();
  const entry = {
    date: document.getElementById("journal-date").value,
    asset: document.getElementById("journal-asset").value,
    direction: document.getElementById("journal-direction").value,
    phase: document.getElementById("journal-phase").value,
    thesis: document.getElementById("journal-thesis").value,
    entry: parseFloat(document.getElementById("journal-entry").value || "0"),
    exit: parseFloat(document.getElementById("journal-exit").value || "0"),
    sl: parseFloat(document.getElementById("journal-sl").value || "0"),
    tp: parseFloat(document.getElementById("journal-tp").value || "0"),
    size: parseFloat(document.getElementById("journal-size").value || "0"),
    outcome: document.getElementById("journal-outcome").value,
    pnl: parseFloat(document.getElementById("journal-pnl").value || "0"),
    emotion: document.getElementById("journal-emotion").value,
    mistakes: document.getElementById("journal-mistakes").value,
  };
  const key = window.JOURNAL_KEY || "griffinsrise_journal_v1";
  const data = JSON.parse(localStorage.getItem(key) || "[]");
  data.push(entry);
  localStorage.setItem(key, JSON.stringify(data));
  this.reset();
  document.getElementById("journal-pnl").value = "";
  if (window.renderDashboard) window.renderDashboard();
  if (window.renderJournalTable) window.renderJournalTable();
  document.getElementById("journal-message").textContent = "Entry added!";
};
</script>

<script>
function renderJournalTable() {
  // 1. Get the journal entries from localStorage
  const key = window.JOURNAL_KEY || "griffinsrise_journal_v1";
  const data = JSON.parse(localStorage.getItem(key) || "[]");

  // 2. Find your journal table body (add this <tbody id="journal-table-body"> if you don't have one)
  const tableBody = document.getElementById("journal-table-body");
  if (!tableBody) return;

  // 3. Clear table
  tableBody.innerHTML = "";

  // 4. If no entries
  if (!data.length) {
    document.getElementById("journal-progress").textContent = "No entries yet.";
    return;
  }

  // 5. Otherwise, show table rows
  document.getElementById("journal-progress").textContent = `${data.length} entries logged.`;
  for (let entry of data) {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${entry.date || ""}</td>
      <td>${entry.asset || ""}</td>
      <td>${entry.direction || ""}</td>
      <td>${entry.phase || ""}</td>
      <td>${entry.thesis || ""}</td>
      <td>${entry.entry || ""}</td>
      <td>${entry.exit || ""}</td>
      <td>${entry.size || ""}</td>
      <td>${entry.outcome || ""}</td>
      <td>${typeof entry.pnl !== "undefined" ? entry.pnl : ""}</td>
    `;
    tableBody.appendChild(row);
  }
}

// Call on page load
document.addEventListener("DOMContentLoaded", renderJournalTable);
// Also call after adding an entry! (already in previous code)
</script>

</body>
</html>